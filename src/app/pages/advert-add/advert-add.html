<h4 class="h4 fw-600 mb-24">Новое объявление</h4>

<form [formGroup]="advertAddForm" (ngSubmit)="onSubmit()" class="advert-add-form base mb-48">
    @if (categoriesForSelect(); as categories) {
        <div>
            <label for="category">Выберите категорию <span class="required">*</span></label>
            <div class="middle-field">
                <p-cascadeselect
                    formControlName="category"
                    [options]="categoriesForSelect()"
                    optionLabel="name"
                    [optionValue]="'id'"
                    optionGroupLabel="name"
                    [optionGroupChildren]="['childs']"
                    placeholder="Нажмите, чтобы выбрать"
                    [invalid]="isControlInvalid('category')"
                />
                <app-control-error
                    [form]="advertAddForm"
                    controlName="category"
                    [isSubmitted]="isSubmitted()"
                ></app-control-error>
            </div>
        </div>
    }
    <div>
        <label for="title">Название объявления <span class="required">*</span></label>
        <div>
            <input
                pInputText
                formControlName="title"
                placeholder="Что хотите продать?"
                autocomplete="off"
                [invalid]="isControlInvalid('title')"
            />
            <app-control-error
                [form]="advertAddForm"
                controlName="title"
                [isSubmitted]="isSubmitted()"
            ></app-control-error>
        </div>
    </div>
    <div>
        <label for="description">Описание</label>
        <div>
            <textarea
                pTextarea
                formControlName="description"
                placeholder="Расскажите подробнее о товаре или услуге"
                autoResize="true"
                style="resize: none"
                [invalid]="isControlInvalid('description')"
                class="big-field mb--5"
            ></textarea>
            <app-control-error
                [form]="advertAddForm"
                controlName="description"
                [isSubmitted]="isSubmitted()"
            ></app-control-error>
        </div>
    </div>
    <div>
        <label for="address">Адрес (место проведения сделки) <span class="required">*</span></label>
        <div>
            <input
                pInputText
                formControlName="address"
                placeholder="Начните вводить адрес"
                autocomplete="address"
                [invalid]="isControlInvalid('address')"
            />
            <app-control-error
                [form]="advertAddForm"
                controlName="address"
                [isSubmitted]="isSubmitted()"
            ></app-control-error>
        </div>
    </div>
    <app-images-upload
        [(uploadImages)]="uploadImages"
        class="advert-add-form__upload"
    ></app-images-upload>
    <div>
        <label for="price">Цена <span class="required">*</span></label>
        <div class="small-field">
            <p-inputnumber
                formControlName="price"
                placeholder="0 ₽"
                mode="currency"
                currency="RUB"
                currencyDisplay="symbol"
                locale="ru-RU"
                [minFractionDigits]="0"
                autocomplete="off"
                inputStyleClass="add"
                [invalid]="isControlInvalid('price')"
            />
            <app-control-error
                [form]="advertAddForm"
                controlName="price"
                [isSubmitted]="isSubmitted()"
            ></app-control-error>
        </div>
    </div>
    <div>
        <label for="phone">Номер телефона <span class="required">*</span></label>
        <div class="small-field">
            <p-inputMask
                formControlName="phone"
                type="phone"
                mask="+7 (999) 999 99 99"
                placeholder="+7 (999) 999 99 99"
                autocomplete="phone"
                [invalid]="isControlInvalid('phone')"
            ></p-inputMask>
            <app-control-error
                [form]="advertAddForm"
                controlName="phone"
                [isSubmitted]="isSubmitted()"
            ></app-control-error>
        </div>
    </div>
    <div>
        <label for="email">E-mail</label>
        <div class="small-field">
            <input
                pInputText
                type="email"
                formControlName="email"
                placeholder="Адрес электронной почты"
                autocomplete="email"
                [invalid]="isControlInvalid('email')"
            />
            <app-control-error
                [form]="advertAddForm"
                controlName="email"
                [isSubmitted]="isSubmitted()"
            ></app-control-error>
        </div>
    </div>
    <div class="two-fields">
        <button
            pButton
            type="submit"
            [label]="isLoading() ? 'Размещаем объявление' : 'Разместить объявление'"
            [loading]="isLoading()"
            [disabled]="!isAllRequiredCompleted() || (isSubmitted() && advertAddForm.invalid)"
            class="advert-add-form__submit-btn mt-8"
        ></button>
        <app-form-message
            [success]="successMessage()"
            [error]="errorMessage()"
            [lifeSuccess]="800"
        ></app-form-message>
    </div>
    <div class="advert-add__submit-disclaimer small-field sm">
        <p>Нажимая кнопку «Разместить объявление»</p>
        <p>
            Вы соглашаетесь с <span (click)="openTermsOfServiceDialog()">правилами площадки</span>
        </p>
    </div>
</form>
